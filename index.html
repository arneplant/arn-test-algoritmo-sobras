<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculo Sobras — Debugger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        mono: ['DM Mono', 'monospace'],
                    },
                    colors: {
                        brand: {
                            50: '#f0f4ff',
                            100: '#e0eaff',
                            200: '#c7d7fd',
                            500: '#3d6ef5',
                            600: '#2956e8',
                            700: '#1e42c4',
                        },
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            opacity: 1;
        }

        .sidebar-scroll {
            overflow-y: auto;
        }

        .sidebar-scroll::-webkit-scrollbar {
            width: 4px;
        }

        .sidebar-scroll::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 4px;
        }

        .results-scroll {
            overflow-y: auto;
        }

        .results-scroll::-webkit-scrollbar {
            width: 5px;
        }

        .results-scroll::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 4px;
        }

        .card-hover {
            transition: box-shadow 0.15s, border-color 0.15s;
        }

        .card-hover:hover {
            box-shadow: 0 4px 16px rgba(61, 110, 245, 0.10);
            border-color: #c7d7fd;
        }

        .input-field {
            font-family: 'DM Mono', monospace;
            font-size: 13px;
            width: 100%;
            padding: 7px 10px;
            border: 1.5px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            color: #0f172a;
            outline: none;
            transition: border-color 0.15s, box-shadow 0.15s;
        }

        .input-field:focus {
            border-color: #3d6ef5;
            box-shadow: 0 0 0 3px rgba(61, 110, 245, 0.12);
        }

        .input-mini {
            font-family: 'DM Mono', monospace;
            font-size: 12px;
            width: 100%;
            padding: 5px 8px;
            border: 1.5px solid #e2e8f0;
            border-radius: 5px;
            background: #fafbfc;
            color: #0f172a;
            outline: none;
            transition: border-color 0.15s;
        }

        .input-mini:focus {
            border-color: #3d6ef5;
            background: white;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(6px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.2s ease forwards;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- TOP NAV -->
    <header
        class="bg-white border-b border-slate-200 px-6 py-3 flex items-center justify-between flex-shrink-0 shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-brand-500 rounded-lg flex items-center justify-center shadow-sm">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                        d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 11h.01M12 11h.01M15 11h.01M4 19h16a2 2 0 002-2V7a2 2 0 00-2-2H4a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
            </div>
            <div>
                <h1 class="text-sm font-bold text-slate-900 leading-tight">Calculo Sobras</h1>
                <p class="text-xs text-slate-400 leading-tight font-mono">Algorithm Debugger</p>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <span id="statusBadge" class="hidden text-xs font-semibold px-3 py-1.5 rounded-full"></span>
            <button onclick="runTest()"
                class="text-xs font-semibold px-3 py-2 rounded-lg border border-slate-200 text-slate-600 hover:border-brand-500 hover:text-brand-600 hover:bg-brand-50 transition-all">
                Ejecutar test D_fijo
            </button>
            <button onclick="runCalculo()"
                class="text-xs font-bold px-4 py-2 rounded-lg bg-brand-500 text-white hover:bg-brand-600 transition-all shadow-sm flex items-center gap-1.5">
                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                    <path
                        d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" />
                </svg>
                Calcular
            </button>
        </div>
    </header>

    <!-- MAIN LAYOUT -->
    <div class="flex flex-1 overflow-hidden">

        <!-- LEFT SIDEBAR -->
        <aside class="w-80 bg-white border-r border-slate-200 flex flex-col flex-shrink-0">

            <div class="p-4 border-b border-slate-100">
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3">Parámetros del pedido
                    nuevo</p>
                <div class="grid grid-cols-2 gap-2.5">
                    <div>
                        <label
                            class="text-[10px] font-semibold text-slate-500 uppercase tracking-wide block mb-1">Pedido
                            nuevo</label>
                        <input type="number" id="pedidoNuevo" value="30" class="input-field">
                    </div>
                    <div>
                        <label
                            class="text-[10px] font-semibold text-slate-500 uppercase tracking-wide block mb-1">Stock</label>
                        <input type="number" id="stock" value="500" class="input-field">
                    </div>
                    <div>
                        <label
                            class="text-[10px] font-semibold text-slate-500 uppercase tracking-wide block mb-1">Mínimo</label>
                        <input type="number" id="minimo" value="10" class="input-field">
                    </div>
                    <div>
                        <label
                            class="text-[10px] font-semibold text-slate-500 uppercase tracking-wide block mb-1">Límite
                            mínimo %</label>
                        <input type="number" id="limiteMinimo" value="100" step="0.1" class="input-field">
                    </div>
                    <div class="col-span-2">
                        <label
                            class="text-[10px] font-semibold text-slate-500 uppercase tracking-wide block mb-1">Porcentaje
                            %</label>
                        <input type="number" id="porcentaje" value="2" step="0.1" class="input-field">
                    </div>
                </div>
            </div>

            <div class="px-4 py-3 border-b border-slate-100 flex items-center justify-between flex-shrink-0">
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Pedidos anteriores</p>
                <button onclick="addPedido()"
                    class="text-[11px] font-bold px-2.5 py-1 rounded-md bg-brand-50 text-brand-600 hover:bg-brand-100 transition-colors flex items-center gap-1">
                    <span class="text-base leading-none">+</span> Añadir
                </button>
            </div>

            <div class="flex-1 sidebar-scroll p-3" id="pedidosContainer">
                <div class="text-center text-slate-400 text-xs py-10 leading-loose">
                    Sin pedidos anteriores.<br>
                    Pulsa <strong class="text-slate-500">+ Añadir</strong> para agregar.
                </div>
            </div>

            <div class="p-3 border-t border-slate-100 flex gap-2">
                <button onclick="loadTestData()"
                    class="flex-1 text-[11px] font-semibold py-2 rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300 transition-all">
                    Cargar test fijo
                </button>
                <button onclick="clearPedidos()"
                    class="flex-1 text-[11px] font-semibold py-2 rounded-lg border border-slate-200 text-slate-400 hover:text-red-500 hover:border-red-200 hover:bg-red-50 transition-all">
                    Limpiar
                </button>
            </div>
        </aside>

        <!-- RIGHT: Results -->
        <main class="flex-1 results-scroll p-6 bg-slate-50" id="resultsArea">
            <div class="flex flex-col items-center justify-center h-full text-center text-slate-400">
                <div
                    class="w-16 h-16 bg-white rounded-2xl border border-slate-200 flex items-center justify-center mb-4 shadow-sm">
                    <svg class="w-7 h-7 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                </div>
                <p class="text-sm font-semibold text-slate-500 mb-1">Sin resultados todavía</p>
                <p class="text-xs text-slate-400">Configura los parámetros y pulsa <strong
                        class="text-brand-500">Calcular</strong></p>
            </div>
        </main>
    </div>

    <script>
        // ===== ALGORITHM =====
        const toRate = v => v > 1 ? v / 100 : v

        function calculoSobrasDebug(pedidoNuevo, stock, minimo, limiteMinimo, porcentaje, datosPedidos) {
            const porcentajeRate = toRate(porcentaje)
            const limiteRate = toRate(limiteMinimo)
            const totalStockCogidoPrev = datosPedidos.reduce((acc, p) => acc + Math.max(0, p.aCogerDeStock ?? 0), 0)
            const stockDisponible = Math.max(0, stock - totalStockCogidoPrev)
            const aCogerDeStock = Math.min(Math.max(0, pedidoNuevo), stockDisponible)
            const aFabricar = Math.max(0, pedidoNuevo - aCogerDeStock)
            const terminados = 0
            const pendientes = Math.max(0, aFabricar - terminados)
            const acumuladoPrev = datosPedidos.length === 0 ? 0 : Math.max(0, datosPedidos[datosPedidos.length - 1].acumuladoConAnteriores ?? 0)
            const acumuladoConAnteriores = acumuladoPrev + pendientes
            const saldosCalculados = aFabricar === 0 ? 0 : Math.ceil(aFabricar * porcentajeRate)
            const limiteMinimoAbs = aFabricar === 0 ? 0 : Math.ceil(aFabricar * limiteRate)
            let saldosNecesarios = 0
            if (saldosCalculados !== 0) {
                if (saldosCalculados < minimo) {
                    const rounded = Math.ceil(aFabricar * limiteRate)
                    saldosNecesarios = minimo > rounded ? rounded : minimo;
                }
                else {
                    saldosNecesarios = saldosCalculados
                }
            }
            const sumSaldosVivosPrev = datosPedidos.reduce((acc, p) => acc + Math.max(0, p.saldosAsignadosVivos ?? 0), 0)

            const excedenteSaldos = Math.floor(acumuladoPrev * porcentajeRate) - sumSaldosVivosPrev //saldosAsignadosPedido - saldosNecesarios
            const saldosAsignadosPedido = saldosNecesarios + excedenteSaldos // Math.max(0, saldosNecesarios - sumSaldosVivosPrev)
            const saldosAsignadosVivos = pedidoNuevo <= 0 ? 0 : Math.floor((saldosAsignadosPedido / pedidoNuevo) * Math.max(0, pedidoNuevo - terminados))

            const saldosAsignadosPedidoFinal = saldosAsignadosVivos - aCogerDeStock
            return { pedidoNuevo, stock, minimo, limiteMinimo, porcentaje, porcentajeRate, limiteRate, totalStockCogidoPrev, stockDisponible, aCogerDeStock, aFabricar, terminados, pendientes, acumuladoPrev, acumuladoConAnteriores, saldosCalculados, limiteMinimoAbs, saldosNecesarios, sumSaldosVivosPrev, saldosAsignadosPedido, saldosAsignadosVivos, excedenteSaldos, saldosAsignadosPedidoFinal }
        }

        // ===== PEDIDOS STATE =====
        let pedidos = [], pedidoCounter = 0

        const PEDIDO_FIELDS = [
            { key: 'pedido', label: 'Pedido' },
            { key: 'aCogerDeStock', label: 'A coger stock' },
            { key: 'aFabricar', label: 'A fabricar' },
            { key: 'terminados', label: 'Terminados' },
            { key: 'pendientes', label: 'Pendientes' },
            { key: 'acumuladoConAnteriores', label: 'Acumulado' },
            { key: 'saldosCalculados', label: 'Saldos calc.' },
            { key: 'saldosNecesarios', label: 'Saldos nec.' },
            { key: 'excedenteSaldos', label: 'Excedente' },
            { key: 'saldosAsignadosPedido', label: 'Asig. pedido' },
            { key: 'saldosAsignadosVivos', label: 'Asig. vivos' },
            { key: 'saldosAsignadosPedidoFinal', label: 'Asig. final' },
        ]

        function addPedido(defaults = {}) {
            const id = ++pedidoCounter
            const p = { id, ...PEDIDO_FIELDS.reduce((o, f) => { o[f.key] = defaults[f.key] ?? 0; return o }, {}) }
            pedidos.push(p)
            renderPedidos()
        }

        function removePedido(id) {
            pedidos = pedidos.filter(p => p.id !== id)
            renderPedidos()
        }

        function getPedidoValues() {
            return pedidos.map(p => {
                const obj = {}
                PEDIDO_FIELDS.forEach(f => {
                    const el = document.getElementById(`p_${p.id}_${f.key}`)
                    obj[f.key] = el ? parseFloat(el.value) || 0 : 0
                })
                return obj
            })
        }

        const LETTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'

        function renderPedidos() {
            const container = document.getElementById('pedidosContainer')
            if (pedidos.length === 0) {
                container.innerHTML = `<div class="text-center text-slate-400 text-xs py-10 leading-loose">Sin pedidos anteriores.<br>Pulsa <strong class="text-slate-500">+ Añadir</strong> para agregar.</div>`
                return
            }
            container.innerHTML = pedidos.map((p, idx) => `
    <div class="bg-white rounded-xl border border-slate-200 p-3 mb-2.5 card-hover">
      <div class="flex items-center justify-between mb-2.5">
        <span class="text-[10px] font-bold uppercase tracking-widest text-brand-600 bg-brand-50 px-2 py-0.5 rounded-md">Pedido ${LETTERS[idx] || idx + 1}</span>
        <button onclick="removePedido(${p.id})" class="text-slate-300 hover:text-red-400 transition-colors text-lg leading-none font-light w-6 h-6 flex items-center justify-center rounded hover:bg-red-50">&times;</button>
      </div>
      <div class="grid grid-cols-3 gap-1.5">
        ${PEDIDO_FIELDS.map(f => `
          <div>
            <label class="text-[9px] font-semibold uppercase tracking-wide text-slate-400 block mb-0.5">${f.label}</label>
            <input type="number" id="p_${p.id}_${f.key}" value="${p[f.key]}" class="input-mini">
          </div>
        `).join('')}
      </div>
    </div>
  `).join('')
        }

        function clearPedidos() { pedidos = []; renderPedidos() }

        function loadTestData() {
            pedidos = []; pedidoCounter = 0
            addPedido({ pedido: 17, aCogerDeStock: 17, aFabricar: 0, terminados: 0, pendientes: 0, acumuladoConAnteriores: 0, saldosCalculados: 0, saldosNecesarios: 0, excedenteSaldos: 0, saldosAsignadosPedido: 0, saldosAsignadosVivos: 0, saldosAsignadosPedidoFinal: -17 })
            addPedido({ pedido: 450, aCogerDeStock: 450, aFabricar: 0, terminados: 0, pendientes: 0, acumuladoConAnteriores: 0, saldosCalculados: 0, saldosNecesarios: 0, excedenteSaldos: 0, saldosAsignadosPedido: 0, saldosAsignadosVivos: 0, saldosAsignadosPedidoFinal: -450 })
            addPedido({ pedido: 30, aCogerDeStock: 30, aFabricar: 0, terminados: 0, pendientes: 0, acumuladoConAnteriores: 0, saldosCalculados: 0, saldosNecesarios: 0, excedenteSaldos: 0, saldosAsignadosPedido: 0, saldosAsignadosVivos: 0, saldosAsignadosPedidoFinal: -30 })
            document.getElementById('pedidoNuevo').value = 30
            document.getElementById('stock').value = 500
            document.getElementById('minimo').value = 10
            document.getElementById('limiteMinimo').value = 100
            document.getElementById('porcentaje').value = 2
        }

        function getNum(id) { return parseFloat(document.getElementById(id).value) || 0 }

        function setStatus(type, text) {
            const el = document.getElementById('statusBadge')
            el.className = 'text-xs font-semibold px-3 py-1.5 rounded-full ' +
                (type === 'ok' ? 'bg-emerald-50 text-emerald-700 border border-emerald-200' :
                    'bg-red-50 text-red-600 border border-red-200')
            el.textContent = text
            el.classList.remove('hidden')
        }

        function sectionHeader(label) {
            return `<h2 class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-3 mt-6 first:mt-0 flex items-center gap-2"><span class="flex-1 h-px bg-slate-200"></span><span>${label}</span><span class="flex-1 h-px bg-slate-200"></span></h2>`
        }

        function resultCard(label, value, variant = 'default') {
            const styles = {
                default: { wrap: 'bg-white border-slate-200', label: 'text-slate-400', val: 'text-slate-900' },
                primary: { wrap: 'bg-brand-500 border-brand-500', label: 'text-blue-200', val: 'text-white' },
                success: { wrap: 'bg-emerald-50 border-emerald-200', label: 'text-emerald-500', val: 'text-emerald-800' },
                danger: { wrap: 'bg-red-50 border-red-200', label: 'text-red-400', val: 'text-red-700' },
                warning: { wrap: 'bg-amber-50 border-amber-200', label: 'text-amber-500', val: 'text-amber-800' },
                muted: { wrap: 'bg-slate-50 border-slate-200', label: 'text-slate-400', val: 'text-slate-500' },
            }
            const s = styles[variant] || styles.default
            return `
    <div class="rounded-xl border p-4 card-hover ${s.wrap}">
      <p class="text-[10px] font-semibold uppercase tracking-widest mb-2 ${s.label}">${label}</p>
      <p class="font-mono text-2xl font-bold ${s.val}">${value}</p>
    </div>
  `
        }

        function runCalculo() {
            try {
                const d = calculoSobrasDebug(
                    getNum('pedidoNuevo'), getNum('stock'), getNum('minimo'),
                    getNum('limiteMinimo'), getNum('porcentaje'), getPedidoValues()
                )
                setStatus('ok', '✓ Cálculo correcto')

                document.getElementById('resultsArea').innerHTML = `<div class="fade-in max-w-4xl pb-6">
      ${sectionHeader('Inputs derivados')}
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
        ${resultCard('Porcentaje rate', d.porcentajeRate.toFixed(4), 'muted')}
        ${resultCard('Límite rate', d.limiteRate.toFixed(4), 'muted')}
        ${resultCard('Stock cogido prev.', d.totalStockCogidoPrev, 'warning')}
        ${resultCard('Stock disponible', d.stockDisponible, 'success')}
      </div>

      ${sectionHeader('Distribución')}
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
        ${resultCard('A coger de stock', d.aCogerDeStock, 'success')}
        ${resultCard('A fabricar', d.aFabricar, 'default')}
        ${resultCard('Terminados', d.terminados, 'muted')}
        ${resultCard('Pendientes', d.pendientes, 'warning')}
        ${resultCard('Acumulado prev.', d.acumuladoPrev, 'muted')}
        ${resultCard('Acumulado con anteriores', d.acumuladoConAnteriores, 'default')}
      </div>

      ${sectionHeader('Saldos')}
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
        ${resultCard('Saldos calculados', d.saldosCalculados, 'default')}
        ${resultCard('Límite mínimo abs.', d.limiteMinimoAbs, 'muted')}
        ${resultCard('Saldos necesarios', d.saldosNecesarios, 'default')}
        ${resultCard('Sum saldos vivos prev.', d.sumSaldosVivosPrev, 'muted')}
        ${resultCard('Excedente saldos', d.excedenteSaldos, d.excedenteSaldos < 0 ? 'danger' : 'muted')}
      </div>

      ${sectionHeader('Resultados principales')}
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
        ${resultCard('Saldos asignados pedido', d.saldosAsignadosPedido, 'primary')}
        ${resultCard('Saldos asignados vivos', d.saldosAsignadosVivos, 'primary')}
        ${resultCard('Saldos asignados final', d.saldosAsignadosPedidoFinal, d.saldosAsignadosPedidoFinal < 0 ? 'danger' : 'success')}
      </div>
    </div>`
            } catch (e) {
                setStatus('error', '✕ Error')
                document.getElementById('resultsArea').innerHTML = `
      <div class="bg-red-50 border border-red-200 rounded-xl p-4 text-red-700 text-xs font-mono whitespace-pre-wrap max-w-2xl">${e.message}\n\n${e.stack || ''}</div>`
            }
        }

        function runTest() {
            const A = { pedido: 17, aCogerDeStock: 17, aFabricar: 0, terminados: 0, pendientes: 0, acumuladoConAnteriores: 0, saldosCalculados: 0, saldosNecesarios: 0, excedenteSaldos: 0, saldosAsignadosPedido: 0, saldosAsignadosVivos: 0, saldosAsignadosPedidoFinal: -17 }
            const B = { pedido: 450, aCogerDeStock: 450, aFabricar: 0, terminados: 0, pendientes: 0, acumuladoConAnteriores: 0, saldosCalculados: 0, saldosNecesarios: 0, excedenteSaldos: 0, saldosAsignadosPedido: 0, saldosAsignadosVivos: 0, saldosAsignadosPedidoFinal: -450 }
            const C = { pedido: 30, aCogerDeStock: 30, aFabricar: 0, terminados: 0, pendientes: 0, acumuladoConAnteriores: 0, saldosCalculados: 0, saldosNecesarios: 0, excedenteSaldos: 0, saldosAsignadosPedido: 0, saldosAsignadosVivos: 0, saldosAsignadosPedidoFinal: -30 }

            let errors = [], passes = []
            try {
                const d = calculoSobrasDebug(30, 500, 10, 100, 2, [A, B, C])
                const asserts = [
                    [d.aCogerDeStock, 3, "A coger de Stock"],
                    [d.aFabricar, 27, "A fabricar"],
                    [d.terminados, 0, "Terminados"],
                    [d.pendientes, 27, "Pendientes"],
                    [d.acumuladoConAnteriores, 27, "Acumulado con anteriores"],
                    [d.saldosCalculados, 1, "Saldos Calculados"],
                    [d.saldosNecesarios, 10, "Saldos Necesarios"],
                    [d.excedenteSaldos, 0, "Excedente Saldos"],
                    [d.saldosAsignadosPedido, 10, "Saldos Asignados a pedido"],
                    [d.saldosAsignadosVivos, 10, "Saldos Asignados Vivos"],
                    [d.saldosAsignadosPedidoFinal, 7, "Saldos Asignados a pedido (final)"],
                ]
                asserts.forEach(([actual, expected, label]) => {
                    if (actual !== expected) errors.push({ label, actual, expected })
                    else passes.push({ label, value: actual })
                })
            } catch (e) {
                errors.push({ label: 'Exception', actual: e.message, expected: '—' })
            }

            const allPass = errors.length === 0
            setStatus(allPass ? 'ok' : 'error', allPass
                ? `✓ Test pasado (${passes.length}/${passes.length + errors.length})`
                : `✕ ${errors.length} fallo(s)`)

            const rowPass = r => `
    <tr class="border-t border-slate-100 hover:bg-slate-50">
      <td class="py-2.5 px-4 text-xs text-slate-600">${r.label}</td>
      <td class="py-2.5 px-4 text-center font-mono text-xs font-medium text-emerald-700">${r.value}</td>
      <td class="py-2.5 px-4 text-center font-mono text-xs font-medium text-emerald-700">${r.value}</td>
      <td class="py-2.5 px-4 text-center">
        <span class="inline-flex items-center gap-1 text-[10px] font-bold text-emerald-700 bg-emerald-50 border border-emerald-200 px-2 py-0.5 rounded-full">✓ OK</span>
      </td>
    </tr>`
            const rowFail = r => `
    <tr class="border-t border-red-100 bg-red-50">
      <td class="py-2.5 px-4 text-xs text-slate-700 font-medium">${r.label}</td>
      <td class="py-2.5 px-4 text-center font-mono text-xs text-red-600 font-bold">${r.actual}</td>
      <td class="py-2.5 px-4 text-center font-mono text-xs text-slate-500">${r.expected}</td>
      <td class="py-2.5 px-4 text-center">
        <span class="inline-flex items-center gap-1 text-[10px] font-bold text-red-600 bg-red-100 border border-red-200 px-2 py-0.5 rounded-full">✕ FAIL</span>
      </td>
    </tr>`

            document.getElementById('resultsArea').innerHTML = `<div class="fade-in max-w-2xl pb-6">
    ${sectionHeader('Test — test_calculoSobras_D_fijo')}
    <div class="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm">
      <table class="w-full">
        <thead>
          <tr class="bg-slate-50 border-b border-slate-200">
            <th class="text-left text-[10px] font-bold uppercase tracking-widest text-slate-400 py-2.5 px-4">Assertion</th>
            <th class="text-center text-[10px] font-bold uppercase tracking-widest text-slate-400 py-2.5 px-4">Obtenido</th>
            <th class="text-center text-[10px] font-bold uppercase tracking-widest text-slate-400 py-2.5 px-4">Esperado</th>
            <th class="text-center text-[10px] font-bold uppercase tracking-widest text-slate-400 py-2.5 px-4">Estado</th>
          </tr>
        </thead>
        <tbody>
          ${passes.map(rowPass).join('')}
          ${errors.map(rowFail).join('')}
        </tbody>
      </table>
    </div>
  </div>`
        }

        renderPedidos()
    </script>
</body>

</html>